- name: Create Git Secret for FluxCD
  delegate_to: 'localhost'
  become: false
  ansible.builtin.shell: |
    export KUBECONFIG="{{ fluxcd_kubernetes.config_path }}"
    flux create secret git {{ flux_secret.name }} \
      --url={{ flux_secret.url }} \
      --username={{ flux_secret.username }} \
      --password={{ flux_secret.password }}
  args:
    executable: /bin/bash
  when: "flux_secret.type == 'git'"
  register: bass_result
  changed_when: "bass_result.rc == 0"

- name: Create Helm Secret for FluxCD
  delegate_to: 'localhost'
  become: false
  ansible.builtin.shell: |
    export KUBECONFIG="{{ fluxcd_kubernetes.config_path }}"
    flux create secret git {{ flux_secret.name }} \
      --namespace={{ flux_secret.namespace }} \
      --username={{ flux_secret.username }} \
      --password={{ flux_secret.password }}
  args:
    executable: /bin/bash
  when: "flux_secret.type == 'helm'"
  register: bass_result
  changed_when: "bass_result.rc == 0"
